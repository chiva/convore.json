[{"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301120779.1710989, "message": "I've been tinkering with Varnish for the past couple of weeks, trying to make my site play nicely under any sort of load", "group_id": 81, "id": 445278}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301120852.587445, "message": "or ..", "group_id": 81, "id": 445283}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301120825.314532, "message": "but I keep running into problems with Django's CSRF stuff....", "group_id": 81, "id": 445281}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301120847.1535201, "message": "either the cookie stripping isn't working the way I expect it to", "group_id": 81, "id": 445282}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301120805.986028, "message": "I've got a few cookies that I think I've managed to strip out using things I've found on various sites", "group_id": 81, "id": 445280}, {"user_id": 1, "stars": [], "topic_id": 15439, "date_created": 1301120888.4628971, "message": "We used it at Mochi for a while, but I wasn't the one to set it up...wish I had some advice to give :\\", "group_id": 81, "id": 445288}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301121112.035856, "message": "if it makes any difference, the way I've currently got my stack is nginx => varnish => gunicorn => django", "group_id": 81, "id": 445299}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301121142.393508, "message": "that was... better than no caching, but still not that fantastic", "group_id": 81, "id": 445302}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301120854.004384, "message": "I dunno", "group_id": 81, "id": 445284}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301120891.262074, "message": "where should I look for a good tutorial on handling cookies, \"Vary: Cookie\", and all of that stuff when configuring Varnish for a Django site?", "group_id": 81, "id": 445289}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301120905.1184411, "message": "@ericflo  hehe, me too! :)", "group_id": 81, "id": 445292}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301121129.455842, "message": "for a while there I had taken varnish out of the mix and just used nginx's caching", "group_id": 81, "id": 445300}, {"user_id": 1232, "stars": [], "topic_id": 15439, "date_created": 1301130241.8116241, "message": "What do you guys need to know? I've set up several Varnish instances, and also written some modules for Varnish in C. If you have a specific question then I'll do my best to help.", "group_id": 81, "id": 445709}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301140406.5326519, "message": "my first question is probably how do I make sure that my VCL is doing what I expect it to?", "group_id": 81, "id": 445964}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301140294.153178, "message": "@buro9 thanks!", "group_id": 81, "id": 445963}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301140415.1776021, "message": "can I add like logging.debug lines to my VCL?", "group_id": 81, "id": 445965}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301140416.791141, "message": "Where would I look for this output? varnishlog?", "group_id": 81, "id": 445966}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301140503.1988521, "message": "Next, are there any special considerations you've made for cookies such as Google Analytics, sessionid, csrftoken, and any others?", "group_id": 81, "id": 445969}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301140618.4295299, "message": "What have you done to work around Django's CSRF capabilities while still allowing forms to be submitted? (like begin able to log into the admin)", "group_id": 81, "id": 445973}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301141996.896595, "message": "For example, http://www.varnish-cache.org/docs/2.1/tutorial/increasing_your_hitrate.html#cache-control -- I'm supposed to add this header in the views/middleware?", "group_id": 81, "id": 445996}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301141934.8827181, "message": "I'm running through the Varnish documentation again... there is a lot of very useful info in there, but I'm just unclear on what to do at certain points...", "group_id": 81, "id": 445991}, {"user_id": 25106, "stars": [], "topic_id": 15439, "date_created": 1301158548.540087, "message": "@codekoala there is a log statement: http://www.varnish-cache.org/trac/wiki/VCL#logstr", "group_id": 81, "id": 446565}, {"user_id": 25106, "stars": [], "topic_id": 15439, "date_created": 1301158562.1703651, "message": "it shows up in varnishlog", "group_id": 81, "id": 446566}, {"user_id": 1232, "stars": [], "topic_id": 15439, "date_created": 1301160812.54546, "message": "varnish writes logs to shared memory, it's very noisy and shows all headers and vcl functions being called. with varnish running you can write it out using \"varnishlog -w varnish.bin.log\". this creates a binary log file, which you then access using varnishlog to read out the lines you're interested in (filtering to the requests you're debugging, or just getting everything)... \"varnishlog -r varnish.bin.log > varnish.log\" that reads in the binary file you'd written and dumps a text file from it that you can read... \"varnishlog -r varnish.bin.log > varnish.log -c -o RxURL '^/$'\" that just dumps the log files that relate to the root url requests (with no query string)", "group_id": 81, "id": 446683}, {"user_id": 1232, "stars": [], "topic_id": 15439, "date_created": 1301161010.5337529, "message": "note that using \"log \" to log from VCL is only available in the most recent versions... if you're using the default on RHEL you'll find it doesn't work, but the default on Ubuntu does", "group_id": 81, "id": 446692}, {"user_id": 1232, "stars": [], "topic_id": 15439, "date_created": 1301161074.309238, "message": "if you're on RHEL and want to log, then you'd have to use syslog and use InlineC in varnish to do the logging... but now your logging is split between syslog and varnishlog... so it's really not ideal. how to do this is covered here: http://www.varnish-cache.org/trac/wiki/VCLExampleSyslog", "group_id": 81, "id": 446695}, {"user_id": 1232, "stars": [], "topic_id": 15439, "date_created": 1301160545.039609, "message": "for the: how do I know if Varnish is doing what I want... use varnishlog.", "group_id": 81, "id": 446675}, {"user_id": 1232, "stars": [], "topic_id": 15439, "date_created": 1301160891.2061839, "message": "the flow chart on here http://www.varnish-cache.org/trac/wiki/VCLExampleDefault shows the order and path of the vcl functions... for every function the default varnish version is run before your config defined version is tun", "group_id": 81, "id": 446688}, {"user_id": 1232, "stars": [], "topic_id": 15439, "date_created": 1301160976.7588, "message": "the best thing to do if you want to log from your VCL is to use \"log message\", so in your VCL you would literally write something like \"log 'fetching' req.url\" and it appends using spaces and the log entries go directly into the varnish log shared memory", "group_id": 81, "id": 446691}, {"user_id": 1232, "stars": [], "topic_id": 15439, "date_created": 1301161142.698051, "message": "@codekoala we've done nothing special with cookies except for static files, where we strip all cookies and query string in vcl_recv so that the hash will guarantee a hit on the cached entry", "group_id": 81, "id": 446700}, {"user_id": 1232, "stars": [], "topic_id": 15439, "date_created": 1301161405.5927269, "message": "@codekoala on the increasing hitrate... forget it right now... you're optimising too soon. just work on bedding it in before you look to analysing how to increase your hitrate... but when it does come to it: use the backend logs to see what requests are getting through that you believe should be cached, use varnishlog to analyse a request for one of those, then with the understanding of why vcl_hash didn't catch it, tweak your vcl_recv config", "group_id": 81, "id": 446710}, {"user_id": 13912, "stars": [{"date_created": 1301273463.191251, "user_id": 6415}, {"date_created": 1301289652.3484311, "user_id": 177}, {"date_created": 1301290017.041533, "user_id": 7691}], "topic_id": 15439, "date_created": 1301162296.553098, "message": "here's a complete short config that works well for us http://paste.pocoo.org/show/360002/ nginx on 8080 and headers to see what varnish delivers from cache and what it doesn't", "group_id": 81, "id": 446744}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301286531.4744051, "message": "@ramen  @buro9  @Vasil thank you all for your comments... I'll have to play with these ideas sometime this week.", "group_id": 81, "id": 454891}, {"user_id": 5778, "stars": [], "topic_id": 15439, "date_created": 1301286568.293721, "message": "I guess I never got far enough into the documentation to find some of the things that you all linked to--probably got sidetracked and frustrated too soon!", "group_id": 81, "id": 454898}, {"user_id": 221, "stars": [], "topic_id": 15439, "date_created": 1305166673.711143, "message": "what are the benefits/differences between running varnish -> nginx -> wsgi versus nginx -> varnish -> wsgi", "group_id": 81, "id": 1017587}]